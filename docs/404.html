<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Promise-based Router</title>
</head>
<body>

<h1>Promise-based Router Example</h1>

<script>
  class Emitter {
    constructor(obj) {
      this.obj = obj;
      this.eventTarget = document.createDocumentFragment();
      ["addEventListener", "dispatchEvent", "removeEventListener"].forEach(
        this.delegate,
        this
      );
    }

    delegate(method) {
      this.obj[method] = this.eventTarget[method].bind(this.eventTarget);
    }
  }

  class Events {
    constructor(host) {
      this.host = host;
      new Emitter(host); // add simple event system
      host.on = (eventName, func) => {
        host.addEventListener(eventName, func);
        return host;
      };
    }

    trigger(event, detail, ev) {
      if (typeof event === "object" && event instanceof Event)
        return this.host.dispatchEvent(event);

      if (!ev) ev = new Event(event, { bubbles: false, cancelable: true });

      ev.detail = { ...(detail || {}), host: this.host };

      return this.host.dispatchEvent(ev);
    }
  }

  class Router {
    constructor() {
      this.routes = {};
      this.events = new Events(document);
    }

    addRoute(path, handler) {
      this.routes[path] = handler;
    }

    navigate(path) {
      return new Promise((resolve, reject) => {
        const handler = this.routes[path];
        if (handler) {
          handler();
          resolve();
        } else {
          reject(new Error(`Route not found: ${path}`));
        }
      });
    }
  }

  // Usage
  const router = new Router();

  router.addRoute("/", () => {
    console.log("Home Page");
  });

  router.addRoute("/about", () => {
    console.log("About Page");
  });

  router.navigate("/about")
    .then(() => console.log("Navigation successful"))
    .catch((error) => console.error(error.message));
</script>

</body>
</html>
